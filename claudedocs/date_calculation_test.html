<!DOCTYPE html>
<html>
<head>
    <title>Date Calculation Test - Customer Insurance Expiry Logic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>Customer Insurance Expiry Date Calculation Test</h1>
    <p><strong>Rule:</strong> Expiry Date = Start Date + 1 year - 1 day</p>
    
    <div id="results"></div>

    <script>
        function calculateExpiryDate(startDate) {
            // Calculate expired date: start date + 1 year - 1 day with proper leap year handling
            var expiredDate = new Date(startDate);
            
            // Add exactly 1 year
            expiredDate.setFullYear(startDate.getFullYear() + 1);
            
            // Handle leap year edge case: if start date is Feb 29 and next year is not leap year
            // JavaScript automatically adjusts Feb 29 to Feb 28, which is correct
            
            // Now subtract 1 day from the year anniversary
            expiredDate.setDate(expiredDate.getDate() - 1);
            
            return expiredDate;
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-GB'); // DD/MM/YYYY format
        }

        function runTest(startDateStr, expectedExpiryStr, description) {
            const startDate = new Date(startDateStr);
            const calculatedExpiry = calculateExpiryDate(startDate);
            const expectedExpiry = new Date(expectedExpiryStr);
            
            const pass = calculatedExpiry.getTime() === expectedExpiry.getTime();
            
            return {
                description,
                startDate: formatDate(startDate),
                calculated: formatDate(calculatedExpiry),
                expected: formatDate(expectedExpiry),
                pass
            };
        }

        // Test cases
        const testCases = [
            // Normal cases
            ['2024-01-01', '2024-12-31', 'Standard year (Jan 1 → Dec 31)'],
            ['2024-03-15', '2025-03-14', 'Mid-year date (Mar 15 → Mar 14)'],
            ['2024-09-04', '2025-09-03', 'User example (Sep 4 → Sep 3)'],
            
            // Leap year cases
            ['2024-02-29', '2025-02-28', 'Leap year Feb 29 → Non-leap year Feb 28'],
            ['2023-02-28', '2024-02-27', 'Non-leap year Feb 28 → Leap year Feb 27'],
            ['2020-02-29', '2021-02-28', 'Leap year Feb 29 → Non-leap year Feb 28'],
            
            // Edge cases
            ['2024-12-31', '2025-12-30', 'Year end (Dec 31 → Dec 30)'],
            ['2024-01-31', '2025-01-30', 'Month with 31 days (Jan 31 → Jan 30)'],
            ['2024-02-01', '2025-01-31', 'February start (Feb 1 → Jan 31)'],
            
            // Century leap year cases
            ['1999-02-28', '2000-02-27', 'Century boundary (1999 → 2000)'],
            ['2000-02-29', '2001-02-28', 'Century leap year Feb 29 → Non-leap Feb 28']
        ];

        // Run tests and display results
        const resultsDiv = document.getElementById('results');
        let passCount = 0;

        testCases.forEach(([start, expected, description]) => {
            const result = runTest(start, expected, description);
            
            const div = document.createElement('div');
            div.className = `test-case ${result.pass ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${result.description}</strong><br>
                Start: ${result.startDate} → Calculated: ${result.calculated} (Expected: ${result.expected})
                ${result.pass ? '✅ PASS' : '❌ FAIL'}
            `;
            resultsDiv.appendChild(div);
            
            if (result.pass) passCount++;
        });

        // Summary
        const summaryDiv = document.createElement('div');
        summaryDiv.style.marginTop = '20px';
        summaryDiv.style.fontWeight = 'bold';
        summaryDiv.innerHTML = `
            <h2>Summary</h2>
            <p>Passed: ${passCount}/${testCases.length} tests</p>
            <p>Status: ${passCount === testCases.length ? '✅ ALL TESTS PASS' : '❌ SOME TESTS FAILED'}</p>
        `;
        resultsDiv.appendChild(summaryDiv);
    </script>
</body>
</html>